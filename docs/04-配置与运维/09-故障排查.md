---
title: "故障排查"
category: "配置与运维"
difficulty: "进阶"
estimated_time: "20分钟阅读"
tags:
  - 故障排查
  - 问题诊断
  - 常见错误
  - 解决方案
prerequisites:
  - "[已完成安装](../00-快速开始/02-5分钟安装指南.md)"
  - "[已完成配置](../00-快速开始/03-向导式配置.md)"
  - "[已完成 Gateway 运维](../03-配置与运维/03-Gateway运维.md)"
  - "[日志与监控](./08-日志与监控.md)"
related_docs:
  - ["安全配置", "日志与监控"]
next_steps:
  - []
last_updated: "2026-02-01"
source: "docs/gateway/troubleshooting.md"
---

# 故障排查

> **TL;DR**: 系统化的问题排查流程，快速定位和解决 OpenClaw 的常见问题。


## 快速排查流程

### 第一步：系统诊断

```bash
# 运行全面诊断
openclaw doctor --deep

# 查看诊断报告
openclaw doctor --report
```

**诊断结果示例**：
```
系统诊断报告:

✅ 配置文件: ✅ 有效
✅ Gateway 状态: ⚠️ 未运行
✅ 模型认证: ✅ 已配置
✅ 通道连接: ⚠️ 2/3 连接失败

修复建议:
1. 启动 Gateway 服务
2. 检查网络连接
3. 验证通道配置
```

---

## 常见问题分类

### 一、Gateway 无法启动

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|----------|
| **进程冲突** | 已有 Gateway 在运行 | `pkill -f openclaw` |
| **端口占用** | 端口 18789 被占用 | `lsof -i :18789` |
| **配置错误** | JSON5 语法错误 | `openclaw doctor --fix` |
| **缺少依赖** | Node.js 版本过低 | 更新 Node.js |

### 二、通道连接问题

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|----------|
| **WhatsApp 无法连接** | Token 失效 | 重新扫描 QR 码 |
| **Telegram Bot 无响应** | Token 错误 | 检查 `bots.list` |
| **Discord 连接超时** | Gateway 未响应 | 检查网络连接 |
| **所有通道连接失败** | 检查网络状态 | `ping api.telegram.org` |

### 三、AI 响应问题

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|----------|
| **Agent 不响应** | API 认证失败 | 检查配置 `models.providers` |
| **响应超时** | 网络延迟 | 检查网络连接 |
| **错误：rate limit** | API 频率限制 | 降低调用频率 |
| **模型不存在** | 模型名错误 | 检查可用模型列表 |

### 四、性能问题

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|----------|
| **响应慢** | 网络延迟、模型选择不当 | 更换模型或网络优化 |
| **内存占用高** | 会话未压缩 | 执行 `openclaw compact` |
| **频繁崩溃** | 资源泄漏 | 重启 Gateway 服务 |
| **CPU 使用高** | 检查是否有死循环进程 |

---

## 诊断工具详解

### openclaw doctor - 深度诊断

```bash
# 完整诊断
openclaw doctor --deep

# 只诊断配置（不修复）
openclaw doctor --deep --no-fix

# 自动修复发现的问题
openclaw doctor --fix

# 显示修复报告
openclaw doctor --report
```

**检查项**：

1. ✅ 配置文件语法
2. ✅ 配置文件完整性
3. ✅ 依赖兼容性（Node.js 版本）
4. ⭐ 网络连接性
5. ⭐ API 认证状态
6. ⭐ 通道连接状态
7. 📊 性能指标
8. ⭐ 系统资源使用

---

## 问题诊断流程

### 场景 1：消息发送失败

**诊断步骤**：

1. **查看状态**
   ```bash
   openclaw status
   ```

2. **检查日志**
   ```bash
   openclaw logs --tail 50 | grep "send"
   ```

3. **测试连接**
   ```bash
   openclaw channels probe whatsapp
   ```

4. **验证模型**
   ```bash
   openclaw config get agents.defaults.model
   ```

**常见原因**：
- ❌ Gateway 未运行
- ❌ 目标不在允许列表
- ❌ 通道未连接
- ❌ 模型未认证

---

### 场景 2：性能缓慢

**诊断步骤**：

1. **检查性能指标**
   ```bash
   openclaw metrics
   ```

2. **查看内存使用**
   ```bash
   ps aux | grep openclaw | awk '{print $4/1024}'
   ```

3. 检查会话数
   ```bash
   openclaw sessions list | grep "active"
   ```

4. 检查响应时间
   ```bash
   openclaw logs | grep "response_time" | tail -20
   ```

**优化建议**：
- 减少活跃会话数
- 启用会话压缩
- 降低模型复杂度
- 检查网络延迟

---

## 高级调试

### 实时日志监控

```bash
# 实时查看 Gateway 日志
openclaw logs --follow

# 同时监控性能
openclaw metrics monitor --interval 60 &
```

### 结构化日志分析

```bash
# 导出最近的结构化日志
openclaw logs export --since "1 hour ago" --file structured-log.json

# 分析错误模式
jq -r '.[] | select(.timestamp, .level, .message)' structured-log.json
```

---

## 恢复策略

### 降级重启

```bash
# Graceful 重启 Gateway
sudo systemctl restart openclaw-gateway.service

# 或 macOS
sudo launchctl kickstart -k gui/$(whoami)

# 暴力重启（最后手段）
pkill -9 openclaw && sleep 5 && openclaw gateway &
```

---

## 寻求支持

### 获取社区帮助

```bash
# 搜索文档中的解决方案
openclaw docs | grep "issue"

# 搜索 GitHub Issues
gh issue list --state open --openclaw/openclaw --search "Connection timeout"

# 查看 Wiki
gh wiki list --openclaw
```

### 提问问题

```bash
# 如果上述方法无法解决问题
# 打开文档搜索
openclaw docs

# 创建 Issue
gh issue create --openclaw/openclaw --title "Gateway 无法启动" --body "..."
```

---

## 检查清单

| 类别 | 检查项 | 状态 |
|------|----------|------|
| **基础运行** | [ ] Gateway 进程运行 | [ ] 端口 18789 可访问 |
| **配置文件** | [ ] 语法有效 | [ ] 必需字段完整 |
| **依赖** | [ ] Node.js >= 22 | [ ] 依赖安装完整 |
| **模型认证** | [ ] API Key 有效 | [ ] OAuth 认证正常 |
| **网络连接** | [ ] ping 正常 | [ ] 防火墙已配置 |
| **通道状态** | [ ] WhatsApp 连接 | [ ] Telegram 连接 | [ ] 其他通道正常 |
| **会话数** | [ ] 活跃会话数正常 | [ ] 无过多闲置会话 |
| **性能指标** | [ ] 内存使用 < 80% | [ ] 响应时间 < 2s |

---

## 下一步

- [安全配置](./06-安全配置.md) - 检查安全配置
- [日志与监控](./08-日志与监控.md) - 深入分析日志

**故障排查要点总结**：
- 🔍 **诊断工具**：`openclaw doctor` 全面检查系统状态
- 📋 **问题分类**：Gateway、通道、AI、性能等系统化分类
- 🛠️ **流程化排查**：状态检查 → 日志分析 → 测试连接 → 验证配置
- 🧰 **优化策略**：会话压缩、模型选择、网络优化
- 🔧 **高级调试**：实时日志监控、结构化日志分析
- 📖 **社区支持**：文档搜索、GitHub Issues、社区帮助
- ✅ **检查清单**：系统化的诊断步骤

*更多信息请参考 [文档导航](../00-文档导航.md)*
