---
title: "远程访问"
category: "配置与运维"
difficulty: "进阶"
estimated_time: "15分钟阅读"
tags:
  - 远程访问
  - SSH
  - Tailscale
  - 隧道
prerequisites:
  - "[已完成安装](../00-快速开始/02-5分钟安装指南.md)"
  - "[已完成配置](../00-快速开始/03-向导式配置.md)"
related_docs:
  - ["Gateway运维", "日志与监控"]
next_steps:
  - ["日志与监控"]
last_updated: "2026-02-01"
source: "docs/gateway/remote.md, docs/gateway/tailscale.md"
---

# 远程访问

> **TL;DR**: 通过 SSH 隧道或 VPN 连接到远程 Gateway，实现安全的远程访问。

<ai-only>
**AI 指令区**：本文档说明 OpenClaw 的远程访问方式，包括 SSH 隧道、Tailscale 网络和安全性配置。
</ai-only>

## 远程访问概述

### 架构原理

```
┌─────────────────────────────────────┐
│         本地客户端              │
│  (macOS 应用 / CLI)              │
└────────────┬────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│          Gateway (远程主机）        │
│     ws://host:18789 (需要认证）       │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│     SSH 隧道                    │
│     host:22 (端口转发 18789) │
└─────────────────────────────────────┘
```

---

## 方式一：SSH 隧道（推荐）

### 基本设置

**前提条件**：
- ✅ Gateway 在远程主机运行
- ✅ 本地有 SSH 客户端
- ✅ 知道远程主机地址和用户名
- ✅ Gateway 配置为 `bind: "loopback"`（或 Tailscale）

### 建立 SSH 隧道

```bash
# 基础 SSH 隧道
ssh user@remote-host -p 18789:localhost:18789

# 使用密钥认证（推荐）
ssh -i ~/.ssh/id_rsa user@remote-host -p 18789:localhost:18789

# 带端口号（如果 Gateway 不是 18789）
ssh -L 18789:localhost:2223 user@remote-host

# 保持连接活跃
ssh user@remote-host -o ServerAliveInterval 60
```

### 本地客户端配置

#### macOS 应用

**设置步骤**：
1. 打开设置（Settings → General）
2. 启用"Remote over SSH"
3. 输入连接信息：
   - Host: `user@remote-host` 或 IP 地址
   - Port: `18789`（或 SSH 隧道的本地端口）
   - 自动配置 Tailscale

#### CLI 配置

```bash
# 设置远程 Gateway
openclaw config set \
  gateway.mode remote \
  gateway.remote.url "ws://127.0.0.1:18789" \
  gateway.remote.token "your-secure-token"

# 验证配置
openclaw status
```

---

## 方式二：Tailscale VPN（推荐）

### 优势

- ✅ **零配置**：自动发现同 Tailscale 网络设备
- ✅ **内置认证**：使用 Tailscale 的密钥认证
- ✅ **稳定性**：网络重连更稳定
- ✅ **安全性**：端到端加密
- ✅ **多设备**：所有设备自动互连

### 基础设置

#### 1. 安装 Tailscale

**macOS**：
```bash
# 通过 Homebrew 安装
brew install tailscale

# 登录
tailscale login

# 查看 Tailscale IP
tailscale ip -4
```

**Linux**：
```bash
# 下载并安装
curl -fsSL https://tailscale.com/install.sh | sh

# 登录
sudo tailscale up --authkey $TAILSCALE_AUTH_KEY
```

**Windows**：
从官网下载并安装 Tailscale GUI 客户端。

#### 2. 配置 Tailscale

**创建网络**：

1. 在 Tailscale 中创建一个新的网络（如 "openclaw-network"）
2. 添加设备：
   - 远程 Gateway 主机（`user@remote-host`）
   - macOS/iOS 节点
   - Android 节点

#### 3. 配置 Gateway 暴露

```bash
# 在远程 Gateway 主机上配置
openclaw config set \
  gateway.tailscale.mode "serve" \
  gateway.bind "0.0.0.0"

# 生成并获取 Gateway 令牌
openclaw gateway call config.get
# 记录输出的 payload.hash
```

#### 4. 在本地配置

```bash
# macOS 应用：Settings → General → "Tailscale 网络选择"
# CLI：无需配置，自动发现
```

---

## 安全配置

### Gateway 认证

**使用 Gateway 令牌（推荐）**：

```json5
{
  "gateway": {
    "auth": {
      "token": "your-secure-token-here"
    }
  }
}
```

**重要提示**：
- ⚠️ 令牌必需：非 loopback 绑定必须使用令牌
- 🔒 保存安全：不要在命令行或脚本中硬编码令牌
- ✅ 定期更换：每月更换一次

### SSH 密钥认证

**生成新密钥**：
```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/openclaw_remote

# 复制公钥到远程主机
ssh-copy-id ~/.ssh/openclaw_remote.pub user@remote-host

# 在远程主机上添加 authorized_keys
cat ~/.ssh/openclaw_remote.pub >> ~/.ssh/authorized_keys
```

### 安全最佳实践

| 实践 | 说明 |
|------|------|----------|
| **使用令牌** | 所有远程连接必须使用令牌认证 | ⭐⭐⭐ |
| **密钥轮转** | 每 3 个月轮换 SSH 密钥 | ⭐⭐ |
| **最小权限** | 只授予必要的访问权限 | ⭐⭐⭐ |
| **监控访问日志** | 定期检查 SSH 登录日志 | ⭐⭐ |
| **网络隔离** | 使用 Tailscale 网络隔离 | ⭐⭐⭐⭐ |

---

## 使用对比

| 访问方式 | 易用性 | 安全性 | 适用场景 | 成本 |
|---------|------|--------|----------|------|
| **Tailscale** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 家庭/团队 | 免费 |
| **SSH 隧道** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | 个人/开发 | 免费 |
| **SSH 直连** | ⭐⭐⭐⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ | 开发 | 免费 |

---

## 故障排查

### 问题 1：无法连接到远程 Gateway

**排查步骤**：
```bash
# 1. 检查 SSH 连接
ssh user@remote-host echo "test"

# 2. 检查端口转发
netstat -an | grep 18789

# 3. 检查 Gateway 运行状态
ssh user@remote-host "openclaw gateway status"

# 4. 查看远程 Gateway 日志
ssh user@remote-host "tail -n 50 ~/.openclaw/logs/gateway.log"
```

### 问题 2：Tailscale 无法发现

**解决方案**：
```bash
# 确保在同一 Tailscale 网络
tailscale status

# 检查设备连接状态
tailscale status --peers

# 重启 Tailscale
tailscale down
tailscale up
```

### 问题 3：频繁断连

**可能原因**：
1. 网络不稳定
2. 超时设置过短
3. Gateway 重启
4. 防火墙阻断

**解决方案**：
```bash
# 1. 增加超时设置
openclaw config set gateway.auth.timeout 6000

# 2. 使用 Tailscale（更稳定）
# 3. 调整重试策略
openclaw config set channels.whatsapp.reconnectInterval 120000
```

---

## 最佳实践

### 1. 生产环境建议

**推荐配置**：
```json5
{
  "gateway": {
    "tailscale": {
      "mode": "serve",
      "network": "openclaw-network"  // 专用网络
      "enableDiscovery": true  // 启用设备发现
      "allowedPeers": []  // 空列表（所有设备）
    }
  }
}
```

### 2. 多用户访问

**场景**：家庭多人同时使用 OpenClaw

**配置方式**：
```bash
# 每个用户使用独立的会话
# 不同的工作空间
# 不同的模型配置（可选）
```

### 3. 性能优化

**优化建议**：
- ✅ 使用 Tailscale：网络更稳定，延迟更低
- ✅ 减少 WebSocket 超时
- ✅ 优化会话压缩：节省 Token
- ✅ 使用缓存：减少重复计算

---

## 下一步文档

- [日志与监控](./08-日志与监控.md) - 深入了解日志管理和监控
- [Gateway 运维](./03-Gateway运维.md) - 学习 Gateway 服务管理
- [安全配置](./06-安全配置.md) - 了解安全策略和配置
- [故障排查](./09-故障排查.md) - 深入问题排查流程

---

<ai-search-key>
远程访问, SSH, 隧道, Tailscale, VPN, 安全, 认证, 令牌, 密钥, 授权, 设备发现, 网络配置, 性能优化, 最佳实践, 故障排查, 连接问题, 断连, 网络不稳定
</ai-search-key>

**远程访问要点总结**：
- 🌐 **三种方式**：SSH 隧道、Tailscale VPN、直连
- 🔒 **安全性**：令牌认证、SSH 密钥、Tailscale 密钥
- 📱 **配置方式**：macOS 应用自动配置、CLI 手动配置
- ⭐ **推荐**：Tailscale VPN（零配置、高性能、高安全）
- 🛡️ **最佳实践**：密钥轮转、最小权限、网络隔离、性能优化
- 📋 **故障排查**：连接问题、设备发现、频繁断连
- 🔧 **多用户**：独立会话、工作空间隔离

*更多信息请参考 [文档导航](../00-文档导航.md)*
