---
title: "帮助与调试"
category: "基础使用"
difficulty: "入门"
estimated_time: "10分钟阅读"
tags:
  - 帮助
  - 调试
  - 诊断
  - 故障排查
prerequisites:
  - "[已完成安装](../00-快速开始/02-5分钟安装指南.md)"
  - "[已完成配置](../00-快速开始/03-向导式配置.md)"
related_docs:
  - ["查看状态", "使用斜杠命令"]
next_steps:
  - []
last_updated: "2026-02-01"
---

# 帮助与调试

> **TL;DR**: 使用内置的诊断工具快速定位和解决问题。


## 帮助系统

### openclaw help - 显示帮助

**基本用法**：
```bash
# 显示所有可用命令
openclaw help

# 显示特定命令的帮助
openclaw help message
openclaw help channels
openclaw help sessions
```

**输出示例**：
```
OpenClaw CLI v1.0.0

可用命令:

gateway         运行 Gateway 后台服务
message         发送消息到通道
channels        通道管理
sessions        会话管理
config           配置管理
...
```

### 帮助级别

| 参数 | 说明 |
|------|------|
| `--section` | 只显示特定类别的命令（如 `config`、`gateway`） |
| `--verbose` | 显示详细的参数说明 |

---

## 诊断工具

### openclaw doctor - 诊断检查

**用途**：全面检查系统配置和状态

```bash
# 基础诊断
openclaw doctor

# 深度诊断（包含更多检查）
openclaw doctor --deep

# 修复发现的问题
openclaw doctor --fix

# 自动修复并显示修复报告
openclaw doctor --fix --yes
```

**检查项目**：

| 检查项 | 说明 | 修复方法 |
|---------|------|----------|
| 配置文件验证 | 检查 JSON5 语法和必需字段 | `openclaw doctor --fix` |
| 依赖检查 | 检查 Node.js 版本和依赖 | 更新 Node.js |
| 权限检查 | 检查文件和目录访问权限 | 修改权限 |
| 网络检查 | 测试 WebSocket 连接 | 检查网络配置 |
| 模型认证 | 验证 API Key 和 OAuth | 重新配置认证 |

---

### openclaw diagnose - 深度诊断

**用途**：执行深度诊断，包含性能和资源使用分析

```bash
# 深度诊断
openclaw diagnose --deep

# 生成诊断报告
openclaw diagnose --report

# 检查特定模块
openclaw diagnose --module gateway
openclaw diagnose --module channels
openclaw diagnose --module sessions
```

**诊断报告示例**：
```
诊断报告 (2026-02-01 16:30:00)

系统状态:
  ├─ Node.js: ✅ v22.12.0 (满足要求)
  ├─ 内存使用: 245MB / 512MB (47.7%)
  ├─ CPU 使用: 12%
  └─ 运行时间: 2h 45m

Gateway 状态:
  ├─ 进程: ✅ 运行中 (PID: 12345)
  ├─ WebSocket: ✅ 正常 (端口 18789)
  ├─ 通道: 2/3 已连接
  └─ 会话: 3 活跃

通道状态:
  ├─ WhatsApp: ✅ 已连接 (设备: Desktop Chrome)
  ├─ Telegram: ✅ 已连接 (Bot: @MyBot)
  ├─ Discord: ❌ 未配置
  └─ iMessage: ❌ 未启用

性能指标:
  ├─ 平均响应时间: 850ms
  ├─ 峰值响应时间: 3.2s
  ├─ Token 使用: 2.5M/月
  └─ 错误率: 0.3%

⚠️ 警告:
  - Gateway 运行时间较长 (建议重启)
  - Discord 未配置
  - 内存使用偏高 (建议压缩会话)

💡 建议:
  1. 定期重启 Gateway (每周一次)
  2. 启用会话自动压缩
  3. 配置 Discord 通道
  4. 监控 Token 使用成本
```

---

## 调试模式

### 启用调试

```bash
# 启用全局调试模式
openclaw debug on

# 启用特定模块调试
openclaw debug on --module gateway
openclaw debug on --module channels
openclaw debug on --module sessions
```

### 调试级别

| 级别 | 说明 | 适用场景 |
|------|------|----------|
| `error` | 只显示错误 | 生产环境 |
| `warning` | 错误和警告 | 日常使用 |
| `info` | 全部信息 | 问题排查 |
| `debug` | 详细调试信息 | 深度分析 |
| `trace` | 最详细追踪 | 开发调试 |

### 查看调试日志

```bash
# 实时查看日志
openclaw logs --follow

# 查看特定级别日志
openclaw logs --level debug

# 查看特定会话日志
openclaw logs --session "agent:main:whatsapp:dm:+86138000000"

# 查看特定模块日志
openclaw logs --module gateway
```

---

## 问题诊断

### 按类别诊断

```bash
# 诊断配置问题
openclaw diagnose --category config

# 诊断网络问题
openclaw diagnose --category network

# 诊断性能问题
openclaw diagnose --category performance

# 诊断模型问题
openclaw diagnose --category model
```

### 生成诊断报告

```bash
# 生成完整报告并保存到文件
openclaw diagnose --report --output report-$(date +%Y%m%d).md

# 生成 JSON 格式报告
openclaw diagnose --report --format json --output report.json
```

---

## 常见问题诊断

### 问题 1：Gateway 无法启动

**诊断步骤**：
```bash
# 1. 检查配置
openclaw doctor

# 2. 检查端口占用
lsof -i :18789
netstat -ano | grep 18789

# 3. 查看详细日志
openclaw logs --level error --tail 100

# 4. 手动启动并观察错误
openclaw gateway --port 18789 --verbose
```

**常见原因**：
- 端口被占用
- 配置文件语法错误
- 模型认证失败
- 依赖版本不兼容

---

### 问题 2：消息无法发送

**诊断步骤**：
```bash
# 1. 检查 Gateway 状态
openclaw gateway status

# 2. 检查通道连接
openclaw channels status --all

# 3. 检查会话状态
openclaw sessions list

# 4. 测试消息发送（带详细日志）
openclaw message send --target +86138000000 \
  --message "测试消息" \
  --verbose
```

**常见原因**：
- 目标不在允许列表
- 通道未连接
- 会话未激活（Pending 状态）
- 配对未批准

---

### 问题 3：AI 响应慢或超时

**诊断步骤**：
```bash
# 1. 检查健康状态
openclaw health --probe

# 2. 检查模型配置
openclaw config get agents.defaults.model

# 3. 查看性能指标
openclaw diagnose --category performance

# 4. 查看响应时间日志
openclaw logs | grep "response_time"
```

**优化建议**：
```bash
# 1. 切换到更快的模型
openclaw config set agents.defaults.model "anthropic/claude-haiku-4-5"

# 2. 启用流式响应（某些模型需要）
openclaw config set streaming.enabled true

# 3. 压缩会话上下文
openclaw compact --keep 20

# 4. 调整超时设置
openclaw config set agents.defaults.timeout 120000  # 2分钟
```

---

### 问题 4：内存占用过高

**诊断步骤**：
```bash
# 1. 查看资源使用
openclaw diagnose --category performance

# 2. 查看会话统计
openclaw sessions list --format json

# 3. 压缩所有会话
openclaw compact --all-sessions

# 4. 删除不活跃会话
openclaw sessions prune --idle-days 7
```

**内存优化策略**：
| 策略 | 说明 | 效果 |
|------|------|------|
| 自动压缩 | 消息数达阈值时自动压缩 | 高 |
| 会话清理 | 删除闲置超过 N 天的会话 | 中 |
| 限制活跃会话 | 配置最大活跃会话数 | 高 |
| 沙盒模式 | 隔离非主会话 | 中高 |

---

## 性能分析

### 性能指标收集

```bash
# 收集性能指标
openclaw metrics collect

# 生成性能报告
openclaw metrics report --period 7d

# 实时监控
openclaw metrics monitor --interval 60
```

**性能指标**：

| 指标 | 说明 | 优化建议 |
|------|------|----------|
| 响应时间 (P95) | 95% 的请求响应时间 | < 1s 为优 |
| Token 使用 | 每分钟/每月 Token 消耗 | 监控成本 |
| 错误率 | 请求失败比例 | < 1% 为优 |
| 会话数 | 活跃会话数量 | < 50 为优 |
| 内存使用 | 进程内存占用 | < 512MB 为优 |

---

## 日志管理

### 日志文件位置

```
日志目录: ~/.openclaw/logs/

主要日志文件:
  ├─ gateway.log          # Gateway 主要日志
  ├─ agent.log             # Agent 执行日志
  ├─ channels.log           # 通道连接日志
  └─ error.log             # 错误日志（汇总）
```

### 日志轮转

```bash
# 手动触发日志轮转（归档旧日志）
openclaw logs rotate

# 配置日志轮转策略
openclaw config set logging.rotate.enabled true
openclaw config set logging.rotate.maxSize 100MB
openclaw config set logging.rotate.maxFiles 10
```

### 日志清理

```bash
# 删除超过 30 天的日志
openclaw logs prune --days 30

# 清空所有日志（危险操作）
openclaw logs clear
```

---

## 调试技巧

### 技巧 1：使用条件断点

```bash
# 在代码或脚本中设置调试点
DEBUG_MODE=true openclaw message send \
  --target +86138000000 \
  --message "测试消息"
```

### 技巧 2：捕获完整错误堆栈

```bash
# 设置 Node.js 堆栈捕获
NODE_OPTIONS="--trace-uncaught" openclaw gateway --verbose
```

### 技巧 3：实时监控

```bash
# 同时监控多个组件
openclaw logs --follow &
openclaw metrics monitor &
wait
```

---

## 下一步文档

- [查看状态](./04-查看状态.md) - 监控 Gateway 和通道状态
- [会话管理](./03-会话管理.md) - 管理对话历史
- [发送消息](./01-发送消息.md) - 学习消息发送
- [使用斜杠命令](./02-使用斜杠命令.md) - 查看所有命令
- [常见问题 FAQ](../00-快速开始/05-常见问题FAQ.md) - 查看更多问题

---

<ai-search-key>
帮助, 调试, 诊断, openclaw doctor, openclaw diagnose, 日志, 性能, 优化, 故障排查, 配置检查, 网络检查, 内存优化, 响应时间, Token 使用, 会话清理, 日志管理, 调试技巧, 性能指标
</ai-search-key>

**帮助与调试要点总结**：
- 🏥 **帮助系统**：`openclaw help` 查看所有命令和参数
- 🔬 **诊断工具**：`openclaw doctor` 全面检查配置和状态
- 📊 **深度诊断**：`openclaw diagnose --deep` 性能和资源分析
- 🐛 **调试模式**：启用详细日志用于问题排查
- 📋 **问题诊断**：分类诊断（配置/网络/性能/模型）
- 💰 **性能优化**：监控 Token 使用、响应时间、错误率
- 🗂️ **日志管理**：查看、搜索、归档和清理日志
- 🎯 **优化建议**：针对不同问题提供具体优化策略

*更多信息请参考 [文档导航](../00-文档导航.md)*
