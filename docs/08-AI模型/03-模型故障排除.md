---
title: "AI 模型故障排查"
category: "AI模型"
difficulty: "intermediate"
estimated_time: "10 min"
tags: ["故障排查", "调试", "模型", "api"]
prerequisites: ["AI模型"]
related_docs: []
next_steps: []
last_updated: "2026-01-01"
source: "docs/concepts/model-failover.md, docs/reference/configuration.md"
---

<ai-only>
**摘要**: 常见模型问题包括速率限制、超时、认证错误、配额耗尽等,提供调试命令和配置指南以诊断和解决这些问题。
</ai-only>

# AI 模型故障排查

## 常见问题

### 速率限制(429)

**症状**:
- 请求被拒绝
- 错误消息提及速率限制

**解决方案**:
- 等待几分钟后重试
- 减少请求频率
- 切换到不同的提供商或认证配置文件
- 检查 `auth.cooldownMs` 设置

### 超时错误

**症状**:
- 请求长时间挂起
- 出现超时错误

**解决方案**:
- 检查网络连接
- 增加请求超时时间(配置中的 `timeoutSeconds`)
- 尝试更快的提供商
- 检查代理设置

### 认证错误(401/403)

**症状**:
- API 密钥无效或被撤销
- OAuth 令牌过期
- 令牌刷新失败

**解决方案**:
- API 密钥:验证密钥是否有效,重新生成
- OAuth 令牌:
  - 运行 `openclaw models status --check`
  - 检查令牌是否过期
  - 更新认证配置文件或重新授权
  - 确保 `refresh` 令牌可用
  - 检查应用权限范围

### 配额耗尽

**症状**:
- 请求被拒绝,错误提及配额

**解决方案**:
- 切换到不同的认证配置文件
- 检查提供商的使用情况
- 等待配额重置

## 调试命令

### 查看模型状态

```bash
openclaw models status
```

显示:
- 当前提供商
- 当前模型
- 认证配置文件
- 使用统计(如果可用)

### 测试模型连接

```bash
openclaw models --test <model>
```

### 检查认证状态

```bash
openclaw models status --check
```

退出码:
- `0`: 正常
- `1`: 过期或缺失凭据
- `2`: 即将过期(24小时内)

### 查看详细配置

```bash
openclaw models status --verbose
```

## 配置选项

### 调整超时时间

在配置中设置:

```json5
{
  agents: {
    defaults: {
      timeoutSeconds: 120,  // 增加到 2 分钟
    },
  },
}
```

### 调整冷却时间

```json5
{
  auth: {
    cooldownMs: 60000,  // 1 分钟冷却
  },
}
```

### 启用详细日志

```json5
{
  agents: {
    defaults: {
      verbose: "full",
    },
  },
}
```

## 使用 `/context` 命令

查看当前上下文使用情况:

```bash
/context list
```

检查上下文是否过大导致问题:

```bash
/context detail
```

## 故障转移验证

确保故障转移配置正常工作:

1. **测试回退链**:
   - 故意触发速率限制
   - 验证是否切换到下一个提供商
   - 检查 `usageStats.lastUsed` 更新

2. **验证会话固定**:
   - 使用 `/model <profileId>` 固定会话
   - 确认故障转移时保持固定

3. **检查认证配置文件**:
   - 验证每个配置文件的令牌有效
   - 运行 `openclaw models status --check`

## 网络问题

### 代理设置

如果使用代理,确保:

- 环境变量正确设置
- 代理 URL 可访问
- HTTPS/TLS 配置正确

### TLS/SSL 问题

- 检查证书有效性
- 确保使用 HTTPS 而不是 HTTP
- 验证提供商 API 端点
