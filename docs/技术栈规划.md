# 技术栈规划

> OpenClaw 中文文档 - VitePress + AI 搜索完整技术方案
> **创建时间**: 2026-02-01
> **状态**: 规划完成

---

## 一、总体架构设计

### 1.1 技术栈概览

```
┌─────────────────────────────────────────────────────────┐
│                   文档内容层                        │
│  (中文 Markdown，结构化组织）               │
└────────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│              VitePress 构建层                   │
│  (单语言，预留 i18n 接口）                │
│  ├─ vitepress-plugin-llms (LLM 优化）         │
│  └─ 自定义主题 (AI 友好 UI）                │
└────────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│              搜索优化层                        │
│  ├─ 快速：Local Search (MiniSearch)            │
│  ├─ 推荐：vitepress-knowledge (Google Gemini)     │
│  └─ 高级：可选集成 RAG (预留接口）         │
└────────────────────┬────────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────────────────┐
│            GitHub Pages 部署层                   │
│  (GitHub Actions 自动 CI/CD）                   │
└─────────────────────────────────────────────────────────┘
```

### 1.2 设计原则

**原则 1：渐进式升级路径**

```
入门阶段（免费、快速）
  → vitepress-plugin-search (Local Search)
  → vitepress-plugin-llms (LLM 优化）

推荐阶段（低成本、高质量）
  → vitepress-knowledge (自托管 + Google Gemini)
  → vitepress-plugin-llms (LLM 优化）

高级阶段（可选、高成本）
  → 自定义 RAG API + Qdrant
  → vitepress-plugin-llms (LLM 优化）
```

**原则 2：AI 与人类体验并重**
- ✅ 人类阅读：清晰的导航、美观的 UI、快速搜索
- ✅ AI 检索：结构化元数据、语义化分块、LLM 友好格式

**原则 3：预留国际化接口**
- 当前只实现中文（`zh-CN`）
- 配置文件预留 `locales` 接口
- 目录结构预留 `en/` 路径
- 后续添加英文时无需重构

**原则 4：成本可控**
- 入门阶段：完全免费
- 推荐阶段：$5-10/月（Google Gemini API）
- 高级阶段：可选，基于需求扩展

---

## 二、VitePress 配置方案

### 2.1 基础配置（单语言 + i18n 预留）

```typescript
// docs/.vitepress/config.ts
import { defineConfig } from 'vitepress'
import llmstxt from 'vitepress-plugin-llms'

// ========== 多语言预留接口 ==========
const locales = {
  'zh-CN': {
    label: '简体中文',
    lang: 'zh-CN',
    title: 'OpenClaw 中文文档',
    description: 'OpenClaw - 个人 AI 助手，支持多平台消息通道',
    themeConfig: {
      nav: [
        { text: '首页', link: '/' },
        { text: '快速开始', link: '/00-快速开始/' },
        { text: '基础使用', link: '/01-基础使用/' },
        { text: '消息通道', link: '/02-消息通道/' },
        { text: '核心概念', link: '/03-核心概念/' },
        { text: '配置与运维', link: '/04-配置与运维/' },
        { text: '自动化任务', link: '/05-自动化任务/' },
        { text: '工具与功能', link: '/06-工具与功能/' },
        { text: '平台指南', link: '/07-平台指南/' },
        { text: 'AI 模型', link: '/08-AI模型/' },
        { text: '开发者参考', link: '/09-开发者参考/' },
        { text: '命令行工具', link: '/10-命令行工具/' },
        { text: '附录', link: '/11-附录/' },
      ],
      sidebar: {
        '/00-快速开始/': [
          { text: '什么是 OpenClaw？', link: '/00-快速开始/01-什么是OpenClaw.md' },
          { text: '5分钟安装指南', link: '/00-快速开始/02-5分钟安装指南.md' },
          { text: '向导式配置', link: '/00-快速开始/03-向导式配置.md' },
          { text: '首次连接', link: '/00-快速开始/04-首次连接.md' },
          { text: '常见问题 FAQ', link: '/00-快速开始/05-常见问题FAQ.md' },
        ],
        // ... 其他章节的 sidebar
      },
      search: {
        provider: 'local',
        options: {
          translations: {
            button: '搜索文档',
            modal: {
              noResultsText: '无法找到相关结果',
              resetButtonTitle: '清除查询条件',
              footer: {
                selectText: '选择',
                navigateText: '切换'
              }
            }
          }
        }
      },
      footer: {
        message: '基于 MIT 协议发布',
        copyright: 'Copyright © 2024-present OpenClaw 社区'
      },
      editLink: {
        pattern: 'https://github.com/openclaw/openclaw/edit/main/docs/:path',
        text: '在 GitHub 上编辑此页'
      },
      lastUpdated: {
        text: '最后更新于',
        formatOptions: {
          dateStyle: 'short',
          timeStyle: 'medium'
        }
      }
    }
  },

  // ========== 英文预留（暂不实现）==========
  'en': {
    label: 'English',
    lang: 'en-US',
    title: 'OpenClaw Documentation',
    description: 'OpenClaw - Personal AI Assistant for Multi-Platform Messaging',
    themeConfig: {
      // TODO: 后续添加英文内容时实现
      nav: [],
      sidebar: {}
    }
  }
}

export default defineConfig({
  // ========== 基础配置 ==========
  title: 'OpenClaw 中文文档',
  description: 'OpenClaw - 个人 AI 助手，支持多平台消息通道',
  lang: 'zh-CN',
  
  // ========== 部署配置 ==========
  base: '/openclaw-docs/',  // GitHub Pages 子路径
  outDir: '.vitepress/dist',
  cacheDir: '.vitepress/cache',
  
  // ========== 多语言配置（当前仅中文）==========
  locales: {
    root: { label: '简体中文', lang: 'zh-CN', ...locales['zh-CN'] },
    en: { label: 'English', lang: 'en-US', link: '/en/', ...locales['en'] }
  },
  
  // ========== 插件配置 ==========
  vite: {
    plugins: [
      // LLM 优化（人类 + AI 友好）
      llmstxt({
        ignoreFiles: ['node_modules/*', '.*'],
        customTemplateVariables: {
          appName: 'OpenClaw',
          appUrl: 'https://docs.openclaw.ai',
          version: '1.0.0'
        },
        // 预留自定义标记支持
        customTags: {
          'ai-only': '<ai-only>',      // AI 可见内容
          'human-only': '<human-only>',  // 人类可见内容
          'search-key': '<search-key>'   // 搜索关键词
        }
      })
    ]
  },
  
  // ========== Markdown 配置 ==========
  markdown: {
    lineNumbers: true,
    config(md) {
      // 支持 emoji
      md.use(require('markdown-it-emoji'))
    }
  },
  
  // ========== SEO 优化 ==========
  head: [
    ['link', { rel: 'icon', href: '/favicon.ico' }],
    ['meta', { name: 'theme-color', content: '#3c8772' }],
    ['meta', { property: 'og:type', content: 'website' }],
    ['meta', { property: 'og:locale', content: 'zh_CN' }],
    ['meta', { property: 'og:title', content: 'OpenClaw 中文文档' }],
    ['meta', { property: 'og:description', content: 'OpenClaw 个人 AI 助手，支持 WhatsApp、Telegram、Discord 等多平台消息通道' }],
    ['meta', { name: 'keywords', content: 'OpenClaw, AI助手, WhatsApp, Telegram, 文档, VitePress' }]
  ],
  
  // ========== 构建优化 ==========
  vite: {
    build: {
      chunkSizeWarningLimit: 1000,
      rollupOptions: {
        output: {
          manualChunks: {
            'vue-vendor': ['vue', 'vue-router'],
            'vitepress-vendor': ['vitepress']
          }
        }
      }
    }
  }
})
```

### 2.2 搜索方案对比

| 方案 | 技术栈 | 成本 | AI 能力 | 实施难度 | 推荐阶段 |
|------|--------|------|----------|----------|----------|
| **Local Search** | MiniSearch | 完全免费 | ⭐⭐（关键词搜索） | ⭐ | 入门阶段 |
| **vitepress-knowledge** | Google Gemini Flash | $5-10/月 | ⭐⭐⭐⭐⭐（AI 对话 + RAG） | ⭐⭐ | 推荐阶段 |
| **Algolia DocSearch** | Algolia（可申请免费） | 免费 - $70/月 | ⭐⭐⭐⭐（关键词 + AI 对话） | ⭐⭐ | 可选 |
| **自定义 RAG** | Qdrant + OpenAI/LlamaIndex | $10-50/月 | ⭐⭐⭐⭐⭐⭐（完整语义搜索） | ⭐⭐⭐⭐ | 高级阶段 |

**推荐方案**：vitepress-knowledge（平衡成本与体验）

---

## 三、推荐方案：vitepress-knowledge

### 3.1 方案优势

✅ **自托管**：数据安全，无厂商锁定
✅ **低成本**：Google Gemini Flash - 免费 + 极低成本
✅ **AI 对话**：内置 chatbot UI
✅ **语义搜索**：基于向量数据库
✅ **易于部署**：Docker Compose 一键部署
✅ **文档优化**：自动合并 VitePress 文档为 LLM 友好格式

### 3.2 架构设计

```
┌─────────────────────────────────────────┐
│      GitHub Pages (VitePress)        │
│         静态站点构建                  │
└────────────┬──────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────┐
│   vitepress-knowledge API Server      │
│   (Docker 容器）                   │
│  ├─ 文档合并器                       │
│  ├─ 向量搜索引擎                      │
│  └─ Gemini Flash LLM                │
└───────────────────────────────────────┘
```

### 3.3 实施步骤

#### 步骤 1：安装 vitepress-knowledge

```bash
cd docs
npm install -D vitepress-knowledge
```

#### 步骤 2：配置 VitePress

```typescript
// docs/.vitepress/config.ts
import { defineConfig } from 'vitepress'
import knowledge from 'vitepress-knowledge'

export default defineConfig({
  extends: knowledge({
    serverUrl: 'https://your-knowledge-server.com',
  })
})
```

#### 步骤 3：创建 Docker Compose 配置

```yaml
# docker-compose.yml
version: '3.8'

services:
  knowledge-server:
    image: aklinker1/vitepress-knowledge-server:latest
    ports:
      - '3000:3000'
    volumes:
      - ./docs:/app/docs  # 挂载文档目录
    environment:
      # ========== 基础配置 ==========
      APP_NAME: 'OpenClaw'
      DOMAIN: 'docs.openclaw.ai'
      DOCS_URL: 'https://docs.openclaw.ai'
      
      # ========== Google Gemini 配置 ==========
      # API Key 从环境变量读取
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      
      # ========== 模型选择 ==========
      GEMINI_2_0_FLASH: true  # 使用 Flash 模型（更快、更便宜）
      
      # ========== 自定义提示词 ==========
      SYSTEM_PROMPT: |
        你是 OpenClaw 的文档助手。
        
        基于以下文档内容回答用户问题：
        {{ KNOWLEDGE }}
        
        回答要求：
        1. 准确：基于文档内容，不编造
        2. 简洁：直接给出答案，避免冗长
        3. 结构化：使用分点、表格等格式
        4. 引用：重要配置、命令给出具体位置
        
        如果文档中没有相关信息，请明确说明"文档中未提及此内容"。
      
      # ========== 搜索配置 ==========
      ENABLE_VECTOR_SEARCH: true
      VECTOR_SEARCH_TOP_K: 5  # 返回前 5 个相关文档片段
      
      # ========== UI 配置 ==========
      ENABLE_AI_CHAT: true  # 启用 AI 对话功能
      CHAT_UI_POSITION: 'right'  # 聊天面板位置
      
    restart: unless-stopped
    
  # 可选：Nginx 反向代理
  nginx:
    image: nginx:alpine
    ports:
      - '80:80'
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d:default.conf
    depends_on:
      - knowledge-server
```

#### 步骤 4：创建 Nginx 配置（可选）

```nginx
# nginx.conf
server {
    listen 80;
    server_name docs.openclaw.ai;
    
    location / {
        proxy_pass http://knowledge-server:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket 支持（如果需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # 静态资源缓存
    location /static/ {
        proxy_pass http://knowledge-server:3000;
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 步骤 5：启动服务

```bash
# 构建文档
npm run docs:build

# 启动知识库服务
docker-compose up -d

# 验证服务
curl http://localhost:3000/health
```

### 3.4 成本估算

| 项目 | 成本 | 备注 |
|------|------|------|
| **GitHub Pages** | 完全免费 | 包含 CI/CD |
| **Docker VPS** | $5-15/月（2GB RAM） | Google Cloud、AWS Lightsail |
| **Gemini Flash** | 免费 + $0.001/1K tokens | 大部分免费 |
| **域名** | $10-15/年 | docs.openclaw.ai |
| **总成本** | **$15-30/月** | 可接受范围 |

---

## 四、LLM 文档优化（vitepress-plugin-llms）

### 4.1 工作原理

**生成文件**：
```
.vitepress/dist/
├── llms-full.txt           # 所有文档合并为一个文件
├── llms.txt                # LLM 主文件，包含所有链接
├── page.html              # 人类友好版本（带导航）
└── page.md                # LLM 友好的 Markdown 版本
```

### 4.2 文档标记使用

在每个文档中使用特殊标记控制内容可见性：

```markdown
---
title: "配置文件说明"
category: "配置与运维"
difficulty: "进阶"
tags: ["配置", "JSON", "openclaw.json"]
---

<ai-only>
## AI 指令区

**文档用途说明**：
本文档用于向 AI 解释 OpenClaw 配置文件的结构和使用方法。

**检索规则**：
- 当用户询问"配置"、"设置"、"参数"等关键词时，优先引用本文档
- 先列出所有配置节（channels、agents、gateway 等）
- 针对每个配置节提供：配置项、类型、默认值、示例
- 重要配置给出高亮提示
</ai-only>

<ai-search-key>
配置, 配置文件, openclaw.json, settings, setup
</ai-search-key>

## 配置文件说明

OpenClaw 的配置文件位于 `~/.openclaw/openclaw.json`...

<human-only>
<!-- 导航菜单和其他人类可见 UI 元素 -->
## 相关文档

- [快速配置示例](./01-快速配置示例.md)
- [完整配置参考](./02-完整配置参考.md)
- [配置故障排查](./09-故障排查.md)
</human-only>
```

### 4.3 自定义标签说明

| 标签 | 用途 | 示例 |
|------|------|------|
| `<ai-only>` | 仅 LLM 可见的指令和上下文 | 系统提示词、检索规则 |
| `<human-only>` | 仅人类可见的 UI 元素 | 导航菜单、页脚信息 |
| `<ai-search-key>` | 搜索关键词列表 | 配置, 安装, 部署 |
| `<ai-exclude>` | 完全排除（人类和 AI 都不处理） | 广告、注释代码 |

---

## 五、GitHub Actions 部署配置

### 5.1 Workflow 文件

```yaml
# .github/workflows/deploy.yml
name: Deploy OpenClaw Docs to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - uses: pnpm/action-setup@v4
        with:
          version: 9
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Build with VitePress
        run: pnpm run docs:build
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/.vitepress/dist

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

  # ========== 可选：知识库服务部署 ==========
  deploy-knowledge:
    if: ${{ vars.DEPLOY_KNOWLEDGE == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Deploy Knowledge Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.KNOWLEDGE_HOST }}
          username: ${{ secrets.KNOWLEDGE_USER }}
          key: ${{ secrets.KNOWLEDGE_SSH_KEY }}
          script: |
            cd /path/to/knowledge-server
            docker-compose pull
            docker-compose up -d
```

### 5.2 环境变量配置

在 GitHub 仓库设置中添加以下 Secrets：

| Secret 名称 | 说明 | 示例值 |
|-----------|------|---------|
| `GEMINI_API_KEY` | Google Gemini API Key（知识库服务） | `AIza...` |
| `DEPLOY_KNOWLEDGE` | 是否部署知识库服务（可选） | `true` 或 `false` |
| `KNOWLEDGE_HOST` | 知识库服务器地址（如果部署） | `user@vps-host.com` |
| `KNOWLEDGE_USER` | SSH 用户名（如果部署） | `deploy` |
| `KNOWLEDGE_SSH_KEY` | SSH 私钥（如果部署） | `-----BEGIN RSA PRIVATE KEY-----` |

---

## 六、部署检查清单

### 6.1 前置条件

- [ ] GitHub 仓库公开
- [ ] GitHub Pages 设置：Source → "GitHub Actions"
- [ ] 域名配置（可选）
- [ ] DNS 记录正确（如果使用自定义域名）

### 6.2 本地开发

- [ ] Node.js >= 22 安装
- [ ] pnpm >= 9 安装
- [ ] `docs/.vitepress/config.ts` 配置完成
- [ ] vitepress-plugin-llms 安装
- [ ] vitepress-knowledge 安装（可选）
- [ ] 所有文档添加正确的 Frontmatter

### 6.3 VitePress 配置

- [ ] `base` 路径配置正确
- [ ] `locales` 结构完整（含 i18n 预留）
- [ ] 搜索方案选择（Local 或 knowledge）
- [ ] SEO 元标签配置完整
- [ ] 插件列表正确

### 6.4 文档优化

- [ ] 所有文档使用 `.docs-template.md` 模板
- [ ] Frontmatter 元数据完整
- [ ] `<ai-only>` 标记正确使用
- [ ] `<ai-search-key>` 标签添加关键词
- [ ] 内部链接使用相对路径
- [ ] 代码示例多平台支持

### 6.5 知识库配置（可选）

- [ ] Docker Compose 配置创建
- [ ] Nginx 配置创建（如需要）
- [ ] GitHub Secrets 配置
- [ ] 环境变量测试

### 6.4 部署验证

- [ ] 本地构建成功：`npm run docs:build`
- [ ] 本地预览正常：`npm run docs:preview`
- [ ] GitHub Actions workflow 运行成功
- [ ] 知识库服务可访问（如果启用）
- [ ] 域名解析正确（如果使用）
- [ ] HTTPS 正常工作
- [ ] 搜索功能正常测试
- [ ] 移动端响应式正常
- [ ] SEO 标签验证（使用浏览器工具）

---

## 七、性能优化建议

### 7.1 VitePress 构建优化

```typescript
// docs/.vitepress/config.ts
export default defineConfig({
  vite: {
    build: {
      // 代码分割
      rollupOptions: {
        output: {
          manualChunks: {
            'vue-vendor': ['vue', 'vue-router'],
            'vitepress-vendor': ['vitepress'],
            'llms-vendor': ['llms-stxt']
          }
        }
      },
      
      // 警告限制
      chunkSizeWarningLimit: 1000,
      
      // CSS 代码分割
      cssCodeSplit: true
    },
    
    // 压缩
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  }
})
```

### 7.2 搜索性能优化

#### Local Search 优化

```typescript
// docs/.vitepress/config.ts
export default defineConfig({
  themeConfig: {
    search: {
      provider: 'local',
      options: {
        miniSearch: {
          options: {
            // 分词优化
            tokenize: (text) => text.toLowerCase().split(/\s+/),
            
            // 搜索选项
            searchOptions: {
              fuzzy: 0.2,              // 模糊匹配
              prefix: true,            // 前缀匹配
              boost: {                // 权重提升
                title: 4,            // 标题 4 倍
                text: 2,             // 正文 2 倍
                headings: 1          // 标题 1 倍
              },
              combineWith: 'AND'      // 组合方式
            }
          }
        }
      }
    }
  }
})
```

#### vitepress-knowledge 优化

```yaml
# docker-compose.yml
environment:
  # ========== 搜索性能 ==========
  ENABLE_VECTOR_SEARCH: true
  VECTOR_SEARCH_TOP_K: 5
  ENABLE_HYBRID_SEARCH: true  # 混合关键词 + 语义搜索
  
  # ========== 缓存策略 ==========
  ENABLE_EMBEDDING_CACHE: true
  EMBEDDING_CACHE_TTL: 3600  # 1 小时
  
  # ========== 批处理优化 ==========
  BATCH_SIZE: 32
  MAX_WORKERS: 4
```

### 7.3 CDN 缓存策略

#### GitHub Pages 自动缓存

GitHub Pages 自动添加以下缓存头（无需配置）：

```
Cache-Control: max-age=600, public
ETag: "..."
Last-Modified: "..."
```

#### 自定义 CDN（可选）

如果使用 Cloudflare / Vercel：

```javascript
// _headers 文件（Cloudflare Pages）
/*
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Cache-Control: public, max-age=31536000, immutable

/static/*
  Cache-Control: public, max-age=31536000, immutable
```

---

## 八、SEO 优化

### 8.1 Meta 标签配置

```typescript
// docs/.vitepress/config.ts
export default defineConfig({
  head: [
    // 基础 SEO
    ['meta', { name: 'description', content: 'OpenClaw 中文文档 - 个人 AI 助手，支持 WhatsApp、Telegram、Discord 等多平台消息通道' }],
    ['meta', { name: 'keywords', content: 'OpenClaw,AI助手,WhatsApp,Telegram,Discord,文档,个人AI,本地部署,配置指南' }],
    ['meta', { name: 'author', content: 'OpenClaw 社区' }],
    
    // Open Graph
    ['meta', { property: 'og:type', content: 'website' }],
    ['meta', { property: 'og:locale', content: 'zh_CN' }],
    ['meta', { property: 'og:title', content: 'OpenClaw 中文文档' }],
    ['meta', { property: 'og:description', content: 'OpenClaw - 个人 AI 助手，支持多平台消息通道的完整配置与使用指南' }],
    ['meta', { property: 'og:url', content: 'https://docs.openclaw.ai/' }],
    
    // Twitter Card
    ['meta', { name: 'twitter:card', content: 'summary_large_image' }],
    ['meta', { name: 'twitter:title', content: 'OpenClaw 中文文档' }],
    ['meta', { name: 'twitter:description', content: 'OpenClaw - 个人 AI 助手文档' }],
    
    // 链接和图标
    ['link', { rel: 'canonical', href: 'https://docs.openclaw.ai/' }],
    ['link', { rel: 'icon', href: '/favicon.ico', type: 'image/x-icon' }],
    ['link', { rel: 'apple-touch-icon', href: '/apple-touch-icon.png', type: 'image/png' }]
  ]
})
```

### 8.2 Sitemap 生成

```bash
# 安装 sitemap 插件
npm install -D vitepress-plugin-sitemap

# docs/.vitepress/config.ts
import { defineConfig } from 'vitepress'
import { sitemap } from 'vitepress-plugin-sitemap'

export default defineConfig({
  vite: {
    plugins: [
      sitemap({
        hostname: 'https://docs.openclaw.ai',
        lastmodDateOnlyFilename: true,
        changefreq: 'weekly',
        priority: 0.8
      })
    ]
  }
})
```

---

## 九、监控与日志

### 9.1 GitHub Analytics

在仓库设置中启用 GitHub Pages Analytics（自动提供）：

- 访问量统计
- 页面浏览统计
- 来源分析
- 用户行为分析

### 9.2 自定义分析（可选）

#### 集成 Google Analytics

```html
<!-- docs/.vitepress/theme/Layout.vue -->
<script setup>
import DefaultTheme from 'vitepress/theme'

window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-XXXXXXXXXX')
</script>

<template>
  <DefaultTheme.Layout />
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
</template>
```

#### 集成 Umami（开源隐私友好）

```html
<!-- docs/.vitepress/theme/Layout.vue -->
<script defer data-website-id="YOUR-ID" src="https://analytics.umami.is/script.js"></script>
```

---

## 十、后续升级路径

### 10.1 阶段 1（当前）：vitepress-knowledge

**状态**：推荐方案
**成本**：$15-30/月
**能力**：AI 对话 + 语义搜索

### 10.2 阶段 2（6 个月后）：Algolia DocSearch

**升级内容**：
- 申请 Algolia DocSearch 免费计划
- 替换搜索为 Algolia
- 保留 vitepress-plugin-llms

**预期成本**：免费（符合条件）

### 10.3 阶段 3（1 年后）：完整 RAG

**升级内容**：
- 部署 Qdrant（Docker）
- 集成 LlamaIndex
- 添加流式 AI 对话
- 实现混合检索（关键词 + 语义）

**预期成本**：$30-80/月（包含 API 费用 + 服务器）

---

## 十一、故障排查

### 11.1 常见问题

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| 构建失败 | Node 版本过低 | 升级到 Node >= 22 |
| 部署后 404 | base 路径配置错误 | 检查 `base` 配置 |
| 搜索不工作 | 知识库服务未启动 | 检查 Docker 容器状态 |
| 样式丢失 | 缓存问题 | 清除浏览器缓存 |
| API 密钥错误 | Secrets 配置错误 | 检查 GitHub Secrets |

### 11.2 调试方法

```bash
# 本地调试
npm run docs:dev --debug

# 构建调试
DEBUG=vitepress:* npm run docs:build

# 知识库服务调试
docker-compose logs knowledge-server
```

---

## 十二、参考资源

### 官方文档
- [VitePress 官方文档](https://vitepress.dev)
- [vitepress-plugin-llms](https://github.com/okineadev/vitepress-plugin-llms)
- [vitepress-knowledge](https://github.com/aklinker1/vitepress-knowledge)

### GitHub Actions
- [deploy-pages](https://github.com/actions/deploy-pages)
- [upload-pages-artifact](https://github.com/actions/upload-pages-artifact)

### SEO 优化
- [Open Graph 协议](https://ogp.me/)
- [Twitter Cards](https://developer.twitter.com/en/docs/twitter-for-websites/cards)
- [Google Search Central](https://developers.google.com/search/docs)

---

*本规划基于 2026-02-01 的最新技术调研，随技术演进可能需要调整。*
