---
title: "Gateway ç½‘å…³"
category: "æ ¸å¿ƒæ¦‚å¿µ"
difficulty: "è¿›é˜¶"
estimated_time: "30åˆ†é’Ÿé˜…è¯»"
tags:
  - Gateway
  - ç½‘å…³
  - WebSocket
prerequisites:
  - ["00-æ¶æ„æ¦‚è§ˆ"]
related_docs: ["WebSocket åè®®", "é…ç½®å‚è€ƒ", "ä¼šè¯ç®¡ç†"]
next_steps: ["é…ç½®æ–‡ä»¶è¯´æ˜", "Gateway è¿ç»´"]
last_updated: "2026-02-01"
---

# Gateway ç½‘å…³

> **TL;DR**: Gateway æ˜¯ OpenClaw çš„**æ ¸å¿ƒæ§åˆ¶å¹³é¢**ï¼Œé€šè¿‡ WebSocket ä¸ºæ‰€æœ‰å®¢æˆ·ç«¯æä¾›ç»Ÿä¸€æ¥å£ã€‚

<ai-only>
**AI æŒ‡ä»¤åŒº**ï¼šæœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Gateway çš„å·¥ä½œåŸç†ã€é…ç½®é€‰é¡¹å’Œè¿ç»´æ–¹æ³•ï¼Œä¾› AI ç†è§£å’ŒååŠ©ç”¨æˆ·é…ç½®ã€‚
</ai-only>

---

## Gateway æ¦‚è§ˆ

### æ ¸å¿ƒèŒè´£

Gateway ä½œä¸º OpenClaw çš„ç½‘å…³ï¼Œè´Ÿè´£ï¼š

- ğŸ“± **æ¶ˆæ¯é€šé“ç®¡ç†**ï¼šç»´æŠ¤æ‰€æœ‰æ¶ˆæ¯å¹³å°è¿æ¥
- ğŸ’¬ **ä¼šè¯ç®¡ç†**ï¼šåˆ›å»ºå’Œç®¡ç†å¯¹è¯ä¼šè¯
- ğŸ”§ **å·¥å…·ç³»ç»Ÿ**ï¼šæ³¨å†Œå’Œç®¡ç†å¯ç”¨å·¥å…·
- ğŸ“Š **äº‹ä»¶åˆ†å‘**ï¼šå‘å®¢æˆ·ç«¯æ¨é€çŠ¶æ€æ›´æ–°
- ğŸ› ï¸ **è®¤è¯æˆæƒ**ï¼šå¤„ç†è¿æ¥è®¤è¯å’Œè®¾å¤‡é…å¯¹
- ğŸ”Œ **å®‰å…¨æ§åˆ¶**ï¼šæƒé™æ£€æŸ¥å’Œå®‰å…¨ç­–ç•¥æ‰§è¡Œ

### è¿è¡Œæ–¹å¼

**å¯åŠ¨æ–¹å¼**ï¼š
```bash
# å‰å°è¿è¡Œ
openclaw gateway --port 18789

# åå°è¿è¡Œï¼ˆæ¨èï¼‰
openclaw gateway --port 18789 --daemon
```

**è¿è¡Œä½ç½®**ï¼š
- **é»˜è®¤**ï¼š`ws://127.0.0.1:18789`ï¼ˆä»… loopbackï¼‰
- **è¿œç¨‹è®¿é—®**ï¼š`ws://0.0.0.0:18789`ï¼ˆéœ€é…ç½®è®¤è¯ï¼‰

---

## WebSocket API

### è¿æ¥æ¡æ‰‹

æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ Gateway æ—¶å¿…é¡»å…ˆå‘é€ `connect` è¯·æ±‚ï¼š

```json5
{
  "type": "req",
  "id": "connect",
  "params": {
    "deviceId": "client-uuid",
    "role": "client",  // "client" | "node"
    "auth": {
      "token": "gateway-token-value",  // å¦‚é…ç½®äº†ä»¤ç‰Œ
      "challenge": "server-challenge-nonce"  // è®¾å¤‡é…å¯¹æŒ‘æˆ˜
      "challengeResponse": "challenge-response"  // è®¾å¤‡é…å¯¹å“åº”
    },
    "features": ["chat", "presence", "status"],
    "capabilities": ["message", "agent"],
    "version": "1.0.0"
  }
}
```

**è®¤è¯æµç¨‹**ï¼š

1. **æ–°è®¾å¤‡è¿æ¥**ï¼ˆloopbackï¼‰ï¼š
   - è‡ªåŠ¨æ‰¹å‡†ï¼Œæ— éœ€æŒ‘æˆ˜
   - è·å¾—è®¾å¤‡ä»¤ç‰Œç”¨äºåç»­è¿æ¥

2. **è¿œç¨‹è¿æ¥**ï¼ˆé loopbackï¼‰ï¼š
   - å¿…é¡»é…ç½®è®¤è¯ä»¤ç‰Œï¼ˆ`gateway.auth.token`ï¼‰
   - å¯èƒ½éœ€è¦è®¾å¤‡é…å¯¹ï¼ˆå‘é€ `pairing approve <code>`ï¼‰
   - èŠ‚ç‚¹ï¼ˆ`role: "node"`ï¼‰å¿…é¡»å£°æ˜èƒ½åŠ›

**è®¾å¤‡é…å¯¹æœºåˆ¶**ï¼š

**ç›®çš„**ï¼šå®‰å…¨æ§åˆ¶ï¼Œé˜²æ­¢æœªæˆæƒè®¾å¤‡æ¥å…¥

**é…å¯¹æµç¨‹**ï¼š
1. æ–°è®¾å¤‡å‘é€ `connect` è¯·æ±‚
2. Gateway æ£€æµ‹åˆ°æ–°è®¾å¤‡ï¼Œè¿”å›æŒ‘æˆ˜
3. è®¾å¤‡ç”¨ç§é’¥ç­¾åæŒ‘æˆ˜å“åº”
4. Gateway éªŒè¯ç­¾åï¼Œæ‰¹å‡†è®¾å¤‡
5. è®¾å¤‡è·å¾—è®¾å¤‡ä»¤ç‰Œ
6. åç»­è¿æ¥ä½¿ç”¨ä»¤ç‰Œè‡ªåŠ¨è®¤è¯

---

## æ ¸å¿ƒè¯·æ±‚ç±»å‹

### 1. å¥åº·æ£€æŸ¥

```json5
{
  "type": "req",
  "id": "health",
  "params": {}
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json5
{
  "type": "res",
  "id": "health",
  "ok": true,
  "payload": {
    "status": "healthy",
    "uptime": 86400,  // ç§’
    "sessions": 0,
    "channels": {
      "whatsapp": "connected",
      "telegram": "connected",
      "discord": "disconnected"
    },
    "agents": 0
  }
}
```

---

### 2. æ¶ˆæ¯å‘é€

```json5
{
  "type": "req",
  "id": "send",
  "params": {
    "channel": "whatsapp",  // æˆ– "telegram", "discord" ç­‰
    "target": "+86138000000",  // ç”µè¯å·ç æˆ–ç”¨æˆ· ID
    "message": "Hello from OpenClaw!",
    "idempotencyKey": "unique-key-12345"  // é˜²æ­¢é‡å¤
  }
}
```

**é‡è¦å‚æ•°**ï¼š
- `channel`: ç›®æ ‡æ¶ˆæ¯é€šé“
- `target`: æ¥æ”¶æ–¹æ ‡è¯†ï¼ˆæ ¹æ®é€šé“ç±»å‹ï¼‰
- `idempotencyKey`: å¹‚ç­‰æ€§é”®ï¼Œç›¸åŒè¯·æ±‚è¿”å›ç¼“å­˜ç»“æœ
- `sessionKey`: å¯é€‰ï¼ŒæŒ‡å®šä½¿ç”¨çš„ä¼šè¯

---

### 3. Agent è°ƒç”¨

```json5
{
  "type": "req",
  "id": "agent",
  "params": {
    "message": "è§£é‡Šä»€ä¹ˆæ˜¯ OpenClaw Gateway",  // ç”¨æˆ·æ¶ˆæ¯
    "sessionKey": "agent:main",  // å¯é€‰ï¼Œé»˜è®¤ "main"
    "thinking": "high",  // æ€è€ƒçº§åˆ«ï¼šoff|minimal|low|medium|xhigh|xhigh
    "verbose": true,  // æ˜¯å¦è¿”å›è¯¦ç»†æ—¥å¿—
  }
}
```

**å“åº”ç‰¹ç‚¹**ï¼š
- **æµå¼å“åº”**ï¼šAgent ç”Ÿæˆçš„å“åº”é€šè¿‡ `agent` äº‹ä»¶æµå¼è¿”å›
- **å·¥å…·è°ƒç”¨**ï¼šAgent å¯ä»¥åœ¨å“åº”ä¸­è°ƒç”¨å·¥å…·ï¼Œé€šè¿‡ `tool` äº‹ä»¶è¿”å›ç»“æœ
- **åˆ†å—è¾“å‡º**ï¼šå“åº”é€šè¿‡ `agent.delta` äº‹ä»¶åˆ†å—è¿”å›

---

### 4. é…ç½®ç®¡ç†

#### è·å–é…ç½®

```json5
{
  "type": "req",
  "id": "config.get",
  "params": {}
}
```

#### åº”ç”¨é…ç½®å˜æ›´

```json5
{
  "type": "req",
  "id": "config.apply",
  "params": {
    "raw": "{\n  agents: {\n    defaults: {\n      model: \"anthropic/claude-opus-4-5\"\n    }\n  }\n}",
    "baseHash": "å½“å‰é…ç½®çš„å“ˆå¸Œå€¼",  // é˜²æ­¢å†²çª
    "sessionKey": "agent:main",  // é‡å¯åæ¿€æ´»çš„ä¼šè¯
    "note": "æ›´æ–°æ¨¡å‹é…ç½®",  // å¯é€‰å¤‡æ³¨
    "restartDelayMs": 2000  // é‡å¯å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
  }
}
```

**é‡è¦æç¤º**ï¼š
- âš ï¸ `config.apply` ä¼šæ›¿æ¢æ•´ä¸ªé…ç½®ï¼Œè°¨æ…ä½¿ç”¨
- ğŸ’¡ ä½¿ç”¨ `config.patch` è¿›è¡Œéƒ¨åˆ†æ›´æ–°æ›´å®‰å…¨

---

### 5. ä¼šè¯ç®¡ç†

#### åˆ—å‡ºä¼šè¯

```json5
{
  "type": "req",
  "id": "sessions.list",
  "params": {}
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json5
{
  "type": "res",
  "id": "sessions.list",
  "ok": true,
  "payload": {
    "sessions": [
      {
        "key": "agent:main",
        "channel": "whatsapp",
        "peer": "+86138000000",
        "model": "anthropic/claude-opus-4-5",
        "created": "2026-01-01T00:00:00Z",
        "lastMessageAt": "2026-02-01T10:30:00Z",
        "messageCount": 42
      },
      // ... æ›´å¤šä¼šè¯
    ]
  }
}
```

---

## äº‹ä»¶ç³»ç»Ÿ

### äº‹ä»¶ç±»å‹

| äº‹ä»¶ | è§¦å‘æ—¶æœº | è¯´æ˜ |
|------|----------|------|
| **agent** | Agent ç”Ÿæˆå“åº”æ—¶ | æµå¼è¿”å› AI å†…å®¹ |
| **agent.delta** | å“åº”åˆ†å— | å¤šæ¬¡äº‹ä»¶è¿”å›ç‰‡æ®µ |
| **agent.done** | å“åº”å®Œæˆ | æ ‡è®°ä¸€æ¬¡å®Œæ•´å“åº”ç»“æŸ |
| **chat** | æ–°æ¶ˆæ¯åˆ°è¾¾ | ç”¨æˆ·åœ¨æ¶ˆæ¯å¹³å°å‘é€æ¶ˆæ¯ |
| **presence** | åœ¨çº¿çŠ¶æ€å˜åŒ– | å®¢æˆ·ç«¯ä¸Šçº¿/ä¸‹çº¿ |
| **tick** | å®šæœŸå¿ƒè·³ | æ¯ 30 ç§’ä¸€æ¬¡ |
| **tool** | å·¥å…·è°ƒç”¨ç»“æœ | å·¥å…·æ‰§è¡Œå®Œæˆ |
| **shutdown** | Gateway å…³é—­ | ä¼˜é›…å…³é—­é€šçŸ¥ |

### è®¢é˜…æœºåˆ¶

å®¢æˆ·ç«¯å¯ä»¥åœ¨è¿æ¥æ—¶å£°æ˜éœ€è¦çš„äº‹ä»¶ç±»å‹ï¼š

```json5
{
  "type": "req",
  "id": "connect",
  "params": {
    "subscribe": ["agent", "presence", "tick"]
  }
}
```

---

## é…ç½®é€‰é¡¹è¯¦è§£

### Gateway åŸºç¡€é…ç½®

```json5
{
  "gateway": {
    "port": 18789,  // Gateway ç›‘å¬ç«¯å£
    "bind": "loopback",  // ç»‘å®šåœ°å€ï¼šloopback | 0.0.0.1 | "0.0.0.0"
    "auth": {
      "token": "your-security-token",  // Gateway è®¤è¯ä»¤ç‰Œ
      "mode": "token"  // è®¤è¯æ¨¡å¼ï¼štokenï¼ˆæ¨èï¼‰| password
    },
    "tailscale": {
      "mode": "off"  // Tailscale æ¨¡å¼ï¼šoff | serve | funnel
    }
  }
}
```

### ç»‘å®šæ¨¡å¼é…ç½®

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | å®‰å…¨æ€§ | è¯´æ˜ |
|------|----------|--------|----------|
| **loopback** | æœ¬åœ°å¼€å‘ | ğŸ”’ é«˜ | ä»…æœ¬åœ°å®¢æˆ·ç«¯å¯è¿æ¥ |
| **0.0.0.0** | æœ¬åœ°æ‰€æœ‰æ¥å£ | ğŸ”’ é«˜ | æœ¬åœ°æ‰€æœ‰å®¢æˆ·ç«¯å¯è¿æ¥ |
| **0.0.0.0** | ç‰¹å®šåœ°å€ | âš ï¸ ä¸­ | éœ€è¦è®¤è¯ä»¤ç‰Œæˆ–é…å¯¹ |

---

## è¿ç»´æŒ‡å—

### å¯åŠ¨ Gateway

```bash
# å‰å°è¿è¡Œï¼ˆå¼€å‘æ¨¡å¼ï¼‰
openclaw gateway --port 18789

# åå°è¿è¡Œï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
openclaw gateway --port 18789 --daemon

# è°ƒè¯•æ¨¡å¼
openclaw gateway --port 18789 --verbose
```

### åœæ­¢ Gateway

```bash
# ä¼˜é›…åœæ­¢
openclaw gateway stop

# å¼ºåˆ¶åœæ­¢
pkill -9 -f "openclaw gateway"
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
openclaw logs --tail 100

# è·Ÿè¸ªç‰¹å®šä¼šè¯
openclaw logs --session "agent:main:whatsapp:dm:+86138000000"

# è¿‡æ»¤æ—¥å¿—çº§åˆ«
openclaw logs --level error
```

### å¥åº·æ£€æŸ¥

```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥
openclaw health

# æ·±åº¦å¥åº·æ£€æŸ¥
openclaw health --probe
```

---

## æ•…éšœæ’æŸ¥

### Gateway æ— æ³•å¯åŠ¨

**å¯èƒ½åŸå› **ï¼š
1. ç«¯å£è¢«å ç”¨ï¼ˆ`lsof -i :18789`ï¼‰
2. é…ç½®æ–‡ä»¶è¯­æ³•é”™è¯¯
3. æƒé™ä¸è¶³
4. æ¨¡å‹é…ç½®ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :18789

# 2. éªŒè¯é…ç½®
openclaw doctor

# 3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
openclaw logs --level error
```

### WebSocket è¿æ¥å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. Gateway æœªè¿è¡Œ
2. è®¤è¯ä»¤ç‰Œæ— æ•ˆ
3. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥ Gateway çŠ¶æ€
openclaw gateway status

# 2. æµ‹è¯• WebSocket è¿æ¥
telnet localhost 18789

# 3. æŸ¥çœ‹æ—¥å¿—
openclaw logs | grep -i "websocket"
```

### æ€§èƒ½ä¼˜åŒ–

| é…ç½®é¡¹ | è¯´æ˜ | æ•ˆæœ |
|--------|------|------|
| `session.maxMessages` | ä¼šè¯æœ€å¤§æ¶ˆæ¯æ•° | å‡å°‘å†…å­˜å ç”¨ |
| `session.compactThreshold` | å‹ç¼©é˜ˆå€¼ | è‡ªåŠ¨å‹ç¼©æ—§æ¶ˆæ¯ |
| `session.prune.toolResults` | æ¸…ç†å·¥å…·ç»“æœ | å‡å°‘ä¸Šä¸‹æ–‡ |

---

## ä¸‹ä¸€æ­¥æ–‡æ¡£

- [é…ç½®æ–‡ä»¶è¯´æ˜](../04-é…ç½®ä¸è¿ç»´/00-é…ç½®æ–‡ä»¶è¯´æ˜.md) - å®Œæ•´é…ç½®é€‰é¡¹
- [Gateway è¿ç»´](../04-é…ç½®ä¸è¿ç»´/03-Gatewayè¿ç»´.md) - ç”Ÿäº§ç¯å¢ƒé…ç½®
- [å®‰å…¨é…ç½®](../04-é…ç½®ä¸è¿ç»´/06-å®‰å…¨é…ç½®.md) - å®‰å…¨ç­–ç•¥å’Œæœ€ä½³å®è·µ
- [WebSocket åè®®](../09-å¼€å‘è€…å‚è€ƒ/01-Gatewayåè®®.md) - è¯¦ç»†çš„åè®®æ–‡æ¡£

---

<ai-search-key>
Gateway, ç½‘å…³, WebSocket, è®¤è¯, é…ç½®, ä¼šè¯, äº‹ä»¶, è®¢é˜…, è¿ç»´, æ•…éšœæ’æŸ¥, å¥åº·æ£€æŸ¥, æ—¥å¿—, æ€§èƒ½ä¼˜åŒ–
</ai-search-key>

**Gateway è¦ç‚¹æ€»ç»“**ï¼š
- ğŸŒ å•ä¸€ç½‘å…³æ¶æ„ï¼Œç»Ÿä¸€æ‰€æœ‰é€šä¿¡
- ğŸ”Œ WebSocket API æä¾›åŒå‘å®æ—¶é€šä¿¡
- ğŸ”§ ä¸°å¯Œçš„ç®¡ç† APIï¼ˆé…ç½®ã€ä¼šè¯ã€å·¥å…·ï¼‰
- ğŸ“Š å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿå’Œè®¢é˜…æœºåˆ¶
- ğŸ› ï¸ è®¾å¤‡é…å¯¹å’Œè®¤è¯ä¿éšœå®‰å…¨
- âš™ï¸ çµæ´»çš„é…ç½®é€‰é¡¹ï¼ˆç»‘å®šæ¨¡å¼ã€Tailscaleï¼‰
- ğŸ“± æ”¯æŒå¤šç§å®¢æˆ·ç«¯ï¼ˆCLIã€èŠ‚ç‚¹ã€Web UIï¼‰

*æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ [æ–‡æ¡£å¯¼èˆª](../00-æ–‡æ¡£å¯¼èˆª.md)*
