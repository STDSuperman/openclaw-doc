---
title: "首次连接"
category: "快速开始"
difficulty: "入门"
estimated_time: "10分钟阅读"
tags:
  - 连接
  - 配对
  - 消息通道
  - 验证
prerequisites:
  - "[已完成安装](./02-5分钟安装指南.md)"
  - "[已完成向导配置](./03-向导式配置.md)"
related_docs:
  - ["02-消息通道"]
next_steps:
  - ["01-基础使用/01-发送消息"]
last_updated: "2026-02-01"
source: "docs/start/pairing.md"
---

# 首次连接

> **TL;DR**: 完成向导配置后，发送第一条测试消息，验证 OpenClaw 正常工作。

**关键要点**：
- ✅ 至少连接一个消息通道
- ✅ 配对已批准的设备
- ✅ 验证 AI 响应功能正常
- ✅ 测试基本对话能力

---

<ai-only>
**AI 指令**：首次连接文档包含三个主要部分：
1. **配对（Pairing）**：新设备的配对流程和安全验证
2. **消息通道连接**：如何连接 WhatsApp、Telegram、Discord 等平台
3. **验证测试**：确保一切正常工作
</ai-only>

## 配对（Pairing）基础

### 什么是配对？

配对是 OpenClaw 的安全机制，用于：

- 📱 **设备连接**：macOS/iOS/Android 节点首次连接时需要配对
- 🔐 **远程客户端**：新终端/浏览器连接到 Gateway 时需要配对
- 🔒 **身份验证**：确保只有授权的客户端可以连接

### 配对类型

| 配对类型 | 说明 | 适用场景 | 安全级别 |
|-----------|------|----------|----------|
| **自动配对** | Loopback 连接自动批准 | 低（仅本地） |
| **手动配对** | 远程连接需要批准 | 高（推荐生产） |
| **临时配对** | 一次性的代码输入 | 中（用于调试） |

---

## 第一步：Gateway 连接检查

### 检查 Gateway 是否运行

```bash
# 方法 1：检查状态
openclaw gateway status

# 方法 2：检查健康
openclaw health
```

**预期输出**：
```
Gateway status: running
Health: OK
Sessions: 0
```

**如果 Gateway 未运行**：
```bash
# 启动 Gateway（前台）
openclaw gateway --port 18789

# 或后台启动
openclaw gateway --port 18789 --daemon
```

---

## 第二步：连接 WhatsApp

<ai-only>
WhatsApp 是 OpenClaw 最常用的消息通道，支持私聊和群聊。

**连接步骤**：
1. 确保已安装 Gateway 并运行
2. 运行 WhatsApp 登录命令
3. 使用手机扫描 QR 码
4. 等待连接成功
5. 配置允许列表（可选）
</ai-only>

### 登录 WhatsApp

```bash
openclaw channels login whatsapp
```

**命令输出**：
```
✓ 启动 WhatsApp 登录
扫描下方 QR 码进行连接

████████████████████████████████████████████████
███████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░
████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░
████████████████████████████████████████████████

✓ WhatsApp 登录成功！
使用你的手机 WhatsApp 扫描上方 QR 码
```

### 验证连接

连接成功后：

```bash
# 检查 WhatsApp 通道状态
openclaw channels status whatsapp
```

**预期输出**：
```
Channel: whatsapp
Status: connected
Device: Desktop (Chrome)
```

### 配置权限（可选）

默认情况下，只有你的号码可以发送消息。如需允许其他用户：

**方法 1：编辑配置文件**

```bash
openclaw config set channels.whatsapp.allowFrom '["+86138000000","+86138000001"]'
```

**方法 2：使用 CLI**

```bash
# 添加允许的号码
openclaw channels add-allowed whatsapp "+86138000000"

# 添加允许的群组（使用群组 ID 或 JID）
openclaw channels add-allowed-whatsapp-group "123456789@g.us"
```

**安全提示**：
- ⚠️ 允许列表越大，安全性越低
- ✅ 建议只添加可信的联系人和工作群
- 🔒 生产环境强烈建议启用配对模式

---

## 第三步：连接 Telegram

<ai-only>
Telegram 支持 Bot 模式，私聊和群组功能完善。

**连接步骤**：
1. 获取 Bot Token（创建 Telegram Bot）
2. 在 Gateway 中配置 Token
3. 验证连接
4. 配置权限（可选）
</ai-only>

### 步骤 1：创建 Telegram Bot

1. 访问 [@BotFather](https://t.me/botfather)
2. 发送 `/newbot` 创建新 bot
3. 设置 bot 名称（如 `MyOpenClawBot`）
4. 获取 API Token（保存这个密钥！）

### 步骤 2：配置 Gateway

**方法 1：通过 CLI**

```bash
# 设置 Bot Token
openclaw config set channels.telegram.botToken "你的BotToken:ABC..."
```

**方法 2：通过环境变量（推荐）**

```bash
# 设置环境变量
export TELEGRAM_BOT_TOKEN="你的BotToken:ABC..."
```

**验证配置**：

```bash
# 检查 Telegram 通道状态
openclaw channels status telegram
```

**预期输出**：
```
Channel: telegram
Status: connected
Bot: @MyOpenClawBot
```

### 步骤 3：测试连接

```bash
# 发送测试消息
openclaw message send --target @your_telegram_username --message "Hello OpenClaw!"
```

**预期结果**：
- ✅ Bot 应该回复消息
- ✅ 消息出现在你的 Telegram 私聊中

### 配置群组策略（可选）

```json5
{
  channels: {
      telegram: {
        botToken: "环境变量 TELEGRAM_BOT_TOKEN",
        
        // 群组配置（使用群组 ID）
        groups: {
          "*": {
            "requireMention": true  // 默认：群组需要 @提及
          },
          "-1001234567890": {
            "requireMention": false  // 指定群组不需要 @提及
          }
        },
        
        // 私聊权限（默认所有用户可发送）
        allowFrom: []
      }
  }
}
```

---

## 第四步：连接 Discord

<ai-only>
Discord 服务器模式，支持频道、私聊和丰富的功能。

**连接步骤**：
1. 创建 Discord 应用和 Bot
2. 配置 Gateway
3. 邀请 Bot 到服务器
4. 验证连接
</ai-only>

### 步骤 1：创建 Discord Bot

1. 访问 [Discord Developer Portal](https://discord.com/developers/applications)
2. 点击 "New Application" 创建应用
3. 在 "Bot" 选项卡创建 bot
4. 复制 Bot Token（`MTAw...` 格式）

**重要提示**：
- ⚠️ 默认情况下，Discord Bot 有权限限制（消息内容、文件大小等）
- ✅ 使用 Intent 或 Privileged Intents 获得更多权限
- 🔒 生产环境建议启用服务器模式和配置 Intents

### 步骤 2：配置 Gateway

**方法 1：通过 CLI**

```bash
# 设置 Bot Token
openclaw config set channels.discord.token "你的DiscordBotToken"
```

**方法 2：通过环境变量（推荐）**

```bash
export DISCORD_BOT_TOKEN="你的DiscordBotToken"
```

### 步骤 3：邀请 Bot 到服务器

```bash
# 方法 1：使用邀请链接（需要 Bot 在服务器中）
https://discord.com/oauth2/authorize?client_id=YOUR_CLIENT_ID&scope=bot&permissions=0

# 方法 2：手动邀请（需要管理员权限）
# 右键点击 Bot → Copy ID
# 服务器设置 → Privilege Gateway → 添加 Bot
```

### 步骤 4：验证连接

```bash
# 检查 Discord 通道状态
openclaw channels status discord
```

**预期输出**：
```
Channel: discord
Status: connected
Bot: YourBotName
Guilds: 1
```

### 配置服务器和频道（可选）

```json5
{
  channels: {
      discord: {
        token: "环境变量 DISCORD_BOT_TOKEN",
        
        // 服务器列表（使用服务器 ID）
        guilds: {
          "123456789012345": {
            "channels": ["9876543210987"],  // 允许的频道
            "requireMention": false  // 频道是否需要 @提及
          }
        }
      }
  }
}
```

---

## 第五步：连接其他通道

### iMessage（仅 macOS）

<ai-only>
iMessage 集成本地 Messages 应用，需要 macOS 系统权限。

**前置要求**：
- macOS 设备
- Messages 应用已登录
- 已授予 OpenClaw 访问权限

**连接方法**：

```bash
# 启动 iMessage 通道
openclaw channels login imessage

# 或检查状态
openclaw channels status imessage
```

**预期输出**：
```
Channel: imessage
Status: connected
```

**配置权限（可选）**：

```json5
{
  channels: {
      imessage: {
        // 允许的 Apple ID 或电话号码
        allowFrom: ["+86138000000"]
      }
  }
}
```
</ai-only>

### WebChat（所有平台）

<ai-only>
WebChat 是内置的 Web 界面，无需任何配置即可使用。

**访问方式**：

```bash
# 启动 Gateway 后访问
openclaw gateway --port 18789

# 然后在浏览器中打开
http://127.0.0.1:18789/
```

**功能特点**：
- ✅ 无需安装任何应用
- ✅ 实时聊天界面
- ✅ 支持 Markdown 格式显示
- ✅ 支持代码高亮
- ✅ 支持图片和文件
</ai-only>

---

## 配对模式配置（生产推荐）

### 启用手动配对

```bash
# 查看待配对的设备
openclaw pairing list

# 批准所有配对请求
openclaw pairing approve --all

# 或批准特定通道
openclaw pairing approve whatsapp +86138000000
```

### 配对超时设置

```json5
{
  gateway: {
      pairing: {
        // 自动批准本机连接（loopback）
        approveLocal: true,
        
        // 配对请求超时时间（秒）
        timeout: 300  // 默认 5 分钟
        
        // 最大配对尝试次数
        maxAttempts: 3
      }
  }
}
```

---

## 验证测试

### 发送测试消息

```bash
# 测试 WhatsApp
openclaw message send --target "+86138000000" --message "Hello from OpenClaw!"

# 测试 Telegram（使用 @username）
openclaw message send --target "@your_username" --message "Hello OpenClaw!"

# 测试 Discord（使用频道或 DM）
openclaw message send --target "频道名称" --message "Hello from OpenClaw!"

# 测试 WebChat
# 在浏览器中访问 http://127.0.0.1:18789/ 发送消息
```

### 预期结果

所有通道都应该：
- ✅ 成功接收消息
- ✅ AI 正常响应
- ✅ 会话历史被正确记录

### 常见问题

<ai-search-key>
首次连接, 配对, 测试, 验证, 问题, 故障排查
</ai-search-key>

**Q: QR 码扫描失败？**

**A**: 确保网络连接正常，尝试刷新页面。确保手机摄像头权限已授予。

**Q: Bot 无响应？**

**A**: 检查 Token 是否正确配置。查看 Gateway 日志：`openclaw logs`

**Q: 如何更换通道？**

**A**: 无需删除，直接连接新通道。多个通道可以同时工作。

**Q: 配对请求超时？**

**A**: 默认 5 分钟超时。可在配置中调整 `gateway.pairing.timeout`。

---

## 下一步

- [发送消息](../01-基础使用/01-发送消息.md) - 学习如何与 AI 对话
- [消息通道详解](../02-消息通道/) - 每个通道的详细配置
- [常见问题 FAQ](./05-常见问题FAQ.md) - 查看更多问题
- [Gateway 运维](../04-配置与运维/) - 生产环境配置

---

**恭喜！** 完成首次连接后，你可以开始使用 OpenClaw 了！🎉

*更多信息请参考 [文档导航](../00-文档导航.md)*
